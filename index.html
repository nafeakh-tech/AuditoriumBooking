<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>نظام حجز المدرج</title>
  <style>
    body { font-family: Arial; padding:20px; background:#f4f4f4; text-align:right; }
    form { background:#fff; padding:20px; border-radius:10px; margin-bottom:25px;
           box-shadow:0 0 10px rgba(0,0,0,0.1); max-width:420px; }
    label { display:block; margin-top:10px; }
    input,button { width:100%; padding:8px; margin-top:5px; border-radius:6px; border:1px solid #ccc; }
    button { background:#0078d4; color:#fff; font-weight:bold; cursor:pointer; margin-top:15px; }
    #resultsBox { background:#fff; padding:15px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1); max-width:420px; }
  </style>
</head>
<body>

<h2>نظام حجز المدرج</h2>

<form id="bookingForm">
  <label>تاريخ بداية الفعالية:</label>
  <input type="date" id="startDate" required />
  <div id="dayDisplay" style="margin-top:8px;font-weight:bold;color:#0078d4;"></div>

  <label>تاريخ نهاية الفعالية:</label>
  <input type="date" id="endDate" required />

  <label>وقت بداية الفعالية:</label>
  <input type="time" id="startTime" required />

  <label>وقت نهاية الفعالية:</label>
  <input type="time" id="endTime" required />

  <label>اسم الفعالية:</label>
  <input type="text" id="eventName" required />

  <label>رمز التحقق:</label>
  <input type="password" id="passcode" required placeholder="أدخل رمز الحجز" />

  <button type="submit">تنفيذ الحجز</button>
</form>

<form id="queryForm">
  <h3>استعلام عن الحجوزات</h3>

  <label>أدخل تاريخ البحث:</label>
  <input type="date" id="queryDate" required />

  <label>رمز التحقق:</label>
  <input type="password" id="queryCode" required placeholder="أدخل رمز التحقق" />

  <button type="submit">بحث</button>
</form>

<div id="resultsBox"></div>

<script>
const MASTER_CODE = "12345"; 
const API_URL = "https://script.google.com/macros/s/AKfycbwg5eU9FQY2UQ29wGNzr_tSNEhVjqZoXqnLsE1vf-9E3ku2tP2LSz4cllsuuqbzLDpo/exec";

document.getElementById("startDate").addEventListener("change", () => {
    const d = new Date(document.getElementById("startDate").value);
    const days = ["الأحد","الاثنين","الثلاثاء","الأربعاء","الخميس","الجمعة","السبت"];
    document.getElementById("dayDisplay").innerText = "اليوم: " + days[d.getDay()];
});

document.getElementById("bookingForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  if (document.getElementById("passcode").value !== MASTER_CODE) {
    alert("❌ رمز التحقق غير صحيح");
    return;
  }

  const startVal = document.getElementById("startDate").value;
  const endVal = document.getElementById("endDate").value;
  if (endVal < startVal) {
      alert("❌ تاريخ النهاية لا يمكن أن يكون قبل البداية");
      return;
  }

  const d = new Date(startVal);
  const days = ["الأحد","الاثنين","الثلاثاء","الأربعاء","الخميس","الجمعة","السبت"];

  const payload = {
    startDate: startVal,
    endDate: endVal,
    startTime: document.getElementById("startTime").value,
    endTime: document.getElementById("endTime").value,
    day: days[d.getDay()],
    eventName: document.getElementById("eventName").value
  };

  try {
    await fetch(API_URL, {
      method:"POST",
      mode:"cors",
      headers: {"Content-Type":"text/plain;charset=utf-8"},
      body: JSON.stringify(payload)
    });
    alert("✔ تم الحجز بنجاح");
  } catch(err){
    alert("خطأ بالاتصال: " + err);
  }
});

document.getElementById("queryForm").addEventListener("submit", async (e)=>{
  e.preventDefault();

  if (document.getElementById("queryCode").value !== MASTER_CODE){
    alert("❌ رمز التحقق غير صحيح");
    return;
  }

  const date = document.getElementById("queryDate").value;

  try {
    const res = await fetch(API_URL + "?date=" + date);
    const data = await res.json();

    let html = "<h4>نتائج البحث:</h4>";
    if (data.length === 0){
      html += "<p>لا توجد حجوزات لهذا التاريخ</p>";
    } else {
      data.forEach(r =>{
        html += `<div style='padding:8px;border-bottom:1px solid #ccc'>
        <b>الفعالية:</b> ${r[5]}<br>
        <b>من:</b> ${r[0]} - ${r[2]}<br>
        <b>إلى:</b> ${r[1]} - ${r[3]}<br>
        <b>اليوم:</b> ${r[4]}
        </div>`;
      });
    }
    document.getElementById("resultsBox").innerHTML = html;

  } catch(err){
    alert("خطأ: " + err);
  }
});
</script>

</body>
</html>
