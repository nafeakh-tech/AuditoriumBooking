<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <title>نظام حجز المدرج</title>
  <style>
    body { font-family: Arial, sans-serif; padding:20px; background:#f4f4f4; text-align:right; }
    .card { background:#fff; padding:20px; border-radius:10px; margin-bottom:20px; max-width:600px; box-shadow:0 0 10px rgba(0,0,0,0.08); }
    label { display:block; margin-top:10px; }
    input, button { width:100%; padding:8px; margin-top:5px; border-radius:6px; border:1px solid #ccc; box-sizing:border-box; }
    button { background:#0078d4; color:#fff; font-weight:bold; cursor:pointer; margin-top:15px; }
    .small { max-width:420px; }
  </style>
</head>
<body>
  <h2>نظام حجز المدرج</h2>

  <!-- Booking form: sends POST directly to Google Apps Script Web App -->
  <div class="card small">
    <form id="bookingForm" method="post" action="https://script.google.com/macros/s/AKfycbyZ_LXDt-G6cidQ7vvIireyJozXnfF7BrxtDxeM8AD_2HH0yRehxCSC_LeajFqgCyP9/exec""target="_blank">
      <label>تاريخ بداية الفعالية:</label>
      <input type="date" name="startDate" id="startDate" required />

      <div id="dayDisplay" style="margin-top:8px;font-weight:bold;color:#0078d4;"></div>
      <input type="hidden" name="day" id="day" />

      <label>تاريخ نهاية الفعالية:</label>
      <input type="date" name="endDate" id="endDate" required />

      <label>وقت بداية الفعالية:</label>
      <input type="time" name="startTime" id="startTime" required />

      <label>وقت نهاية الفعالية:</label>
      <input type="time" name="endTime" id="endTime" required />

      <label>اسم الفعالية:</label>
      <input type="text" name="eventName" id="eventName" required />

      <label>رمز التحقق:</label>
      <input type="password" name="passcode" id="passcode" required placeholder="أدخل رمز التحقق" />

      <button type="submit">تنفيذ الحجز</button>
    </form>
  </div>

  <!-- Query form: sends GET to the same Web App -->
  <div class="card small">
    <form id="queryForm" method="get" action="https://script.google.com/macros/s/AKfycbyZ_LXDt-G6cidQ7vvIireyJozXnfF7BrxtDxeM8AD_2HH0yRehxCSC_LeajFqgCyP9/exec"target="_blank">
      <h3>استعلام عن الحجوزات</h3>
      <label>أدخل تاريخ البحث:</label>
      <input type="date" name="date" id="queryDate" required />

      <label>رمز التحقق:</label>
      <input type="password" name="passcode" id="queryPasscode" required placeholder="أدخل رمز التحقق" />

      <button type="submit">بحث</button>
    </form>
  </div>

  <p style="max-width:600px">ملاحظات: بعد الضغط على "تنفيذ الحجز" ستنتقل لصفحة تأكيد ناتجة من Google Apps Script ثم تُعاد إلى صفحة الحجز أو يمكنك الضغط على الرابط للعودة.</p>

<script>
  // Compute Arabic day name and fill hidden input
  function computeDayFromDateValue(dateValue){
    if(!dateValue) return "";
    const d = new Date(dateValue + "T00:00:00");
    const names = ["الأحد","الاثنين","الثلاثاء","الأربعاء","الخميس","الجمعة","السبت"];
    return names[d.getDay()];
  }

  document.getElementById("startDate").addEventListener("change", function(){
    const v = this.value;
    const dayName = computeDayFromDateValue(v);
    document.getElementById("dayDisplay").innerText = dayName ? "اليوم: " + dayName : "";
    document.getElementById("day").value = dayName;
  });

  // Basic client-side validation before submitting booking form
  document.getElementById("bookingForm").addEventListener("submit", function(e){
    const start = document.getElementById("startDate").value;
    const end = document.getElementById("endDate").value;
    if(end < start){
      e.preventDefault();
      alert("❌ تاريخ نهاية الفعالية لا يمكن أن يكون قبل تاريخ البداية");
      return false;
    }
    // ensure day is set
    if(!document.getElementById("day").value){
      document.getElementById("day").value = computeDayFromDateValue(start);
    }
    // allow normal form submission (no AJAX) to the Apps Script
    return true;
  });

  // No JS needed for query form; it will open Apps Script response page with results.
</script>

</body>
</html>
